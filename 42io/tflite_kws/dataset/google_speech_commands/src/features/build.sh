#!/bin/bash

set -e
set -u

export LC_ALL=C

cd "`dirname "${BASH_SOURCE[0]}"`"

mkdir -p ../../bin

gcc -Werror -Wall -Wextra -Wpedantic -Wno-sign-compare -Wno-maybe-uninitialized \
    -I. -I../../lib/c_speech_features-0.4.8/ \
    -I../../lib/c_speech_features-0.4.8/kiss_fft130/ \
    fast/mfcc.c \
    ../../lib/c_speech_features-0.4.8/slow/fbank.c \
    ../../lib/c_speech_features-0.4.8/slow/logfbank.c \
    ../../lib/c_speech_features-0.4.8/slow/lifter.c \
    ../../lib/c_speech_features-0.4.8/slow/get_filterbanks.c \
    ../../lib/c_speech_features-0.4.8/slow/framesig.c \
    ../../lib/c_speech_features-0.4.8/slow/preemphasis.c \
    fast/magspec.c \
    ../../lib/c_speech_features-0.4.8/slow/powspec.c \
    ../../lib/c_speech_features-0.4.8/kiss_fft130/kiss_fft.c \
    ../../lib/c_speech_features-0.4.8/kiss_fft130/tools/kiss_fftr.c \
    -o ../../bin/fe main.c fe.c weak.c -lm

# pymfcc() { python -c '
# import sys
# from python_speech_features import mfcc
# import scipy.io.wavfile as wav
# (rate,sig) = wav.read(sys.argv[1])
# mfcc_feat = mfcc(sig,rate,winlen=0.05,winstep=0.02,nfft=1024)
# for a in mfcc_feat:
#   print " ".join("%9.5f" % x for x in a)
# ' $1; }
# pymfcc src/features/test/backward_0e6e36c9_nohash_2.wav

degrad() {
  awk -v RS='[\n ]' '/./{printf "%.3f\n",$1}'
}

TEST="$(cat <<-EOF
  8.86078  -7.72990   6.68644   2.88050   5.99314   9.25673   7.24494   3.06427  -3.89344 -15.80746 -17.21990  -9.43837 -14.22732
  8.75598  -8.15210   7.64055   2.85522   6.78613   8.28835   6.64559   3.31231  -3.68776 -15.11014 -19.70913 -11.46081 -11.63210
  8.66597  -8.66156   9.55811   2.93116   6.83398   5.23493   1.66801   2.86471  -3.38009  -7.33307 -12.46179  -9.92403 -10.56085
  8.79118  -9.07874  11.15561   8.53310  10.51197   8.13630   3.26946  -3.61265 -12.06438  -7.61348  -9.45574  -3.71995  -4.63264
  9.30169  -6.26065  12.07471  12.02322  15.13058  13.02427   4.40224  -0.26539  -9.48750 -14.57580 -20.47476  -9.54417  -5.37482
  9.65283  -6.60125   8.83474  10.61977  16.59622  10.33489   5.61690   1.92946 -11.28854 -18.44577 -18.83574 -12.66980 -15.53419
  9.77404 -10.32788   9.24977  10.28543  24.56779  13.82494  11.91566   5.20859  -6.76930 -20.75389 -13.26015 -16.71752 -18.08174
  9.51625 -10.79521   8.91843   7.60715  20.80051   7.09508   0.01618  -2.21872  -5.87135 -12.12244  -3.92387 -18.64807 -12.28493
  9.23455 -10.68077   7.78355   4.69191  16.45682  14.53155  -0.25647  -2.67062  -4.59523  -4.29588 -12.09654 -22.91778 -12.06122
 10.86101 -15.49451   1.31355   1.63959   5.11012  11.93502   0.07398 -10.06799  -9.52851  -9.01621   8.03686 -17.60113 -26.67581
 16.79603  -9.94085  -9.78085  -3.54066   9.23811 -13.54147 -10.32779 -21.98321  -5.80961  -1.70162  13.68403 -23.92005 -20.17258
 20.04311  -0.84094 -19.44848  -4.55152  -1.37874 -18.91881   3.30852 -24.90401  28.78971  16.13244   8.99328 -39.11962 -33.90760
 21.03892  -1.20646 -23.31460  -7.70660  -4.39395  -6.90358   3.33602 -16.47240  34.43483  11.50583  12.25307 -46.18375 -25.08242
 21.95243  -0.42265 -31.25409 -12.14778  -6.14618  -2.73012   6.85810 -11.11099  26.14270  12.29143  14.75678 -45.39304 -16.79535
 22.21382  -1.25420 -36.26908 -11.67310  -5.16391  -0.77055   8.29098  -3.98312  17.97254  11.35400  16.22471 -47.75766 -10.43193
 22.20804  -1.29847 -37.61044  -7.89087  -9.82480   1.24129  -0.40596  -2.70186  10.39151  10.61095   8.83984 -42.14556 -10.51919
 21.72632  -3.60848 -32.90119  -7.06502 -12.69796   9.71123  -4.70629   0.59862  11.97353   7.62509   8.87531 -35.87392 -13.14197
 20.88029  -5.77477 -32.87990 -12.51529 -16.08341  14.85696 -14.55178   1.91422  14.04664  -2.55687   7.57199 -32.45962 -15.83790
 19.34466  -6.25688 -24.22890 -12.23228 -12.65541  19.17376 -27.37298   3.16155  17.89603   4.80843   2.94871 -22.18386 -17.91864
 17.77499   1.52947 -34.67848 -19.51675  -3.87841  -5.81210  -2.93361  -4.30766  12.85558  -3.44394  -4.77012 -30.50043 -30.44132
 16.51077   5.50027 -32.04201 -17.41811 -13.70921  -7.76113  -2.45218   3.38569  15.67804  -1.55748   2.77922 -18.02676 -22.45863
 17.24979   4.46973 -32.90688 -34.95617 -30.46476 -20.14319  -4.47377  -3.36388  17.16590 -15.32867   4.40212 -19.45036 -33.41169
 17.25889  13.96791 -14.00357 -24.65968 -16.35137 -10.72676   6.39041  -2.77605  24.25229 -15.61193  11.00543 -14.48360 -32.34773
 16.96108  16.46988  -2.29066 -25.48346  -1.11209 -20.74278  13.73508 -22.06302   8.79685 -25.18830  34.29501   5.85572 -14.48231
 17.40792  14.33761  -4.91388 -23.63156   0.37439 -15.31053  10.32001 -38.65788  -1.87800 -22.96241  52.09575  -1.41819 -19.11928
 17.30231  10.66462  -3.42424 -23.06415  -1.51176 -12.80155   6.83673 -38.42130  -9.19869 -13.65184  55.44277 -11.32774 -20.99168
 16.48392   4.92592  -3.15418 -17.80707  -1.11089  -9.22845  -4.95268 -39.79342  -9.16013  -1.41661  47.02860 -29.80351 -27.88038
 14.64049   2.67934  -2.16613  -0.15813   5.34726  -3.12801  -9.82215 -17.68939  -9.75299  -7.22139  23.18975 -34.64116 -12.18477
 13.77210   1.78042   0.42138   7.92622  -3.38124  -1.02297 -21.44439 -15.49002 -22.54449  -5.52900  23.27613 -21.42672 -18.13403
 12.35620   4.80430   3.83666   3.95168  -0.39998   6.35358  -5.20856 -13.41884 -23.72606  -1.70635   5.73962 -18.88482 -19.06042
 16.01674 -12.46135 -20.87287  24.94849 -25.07395  -9.83552  -6.08841 -23.84274   2.19457  -4.94946   8.84344  -8.72902 -20.33740
 16.49800 -17.06808 -24.20051  16.83693 -22.88172 -15.28558 -14.56650 -29.25394   5.24754  -9.52467   7.92764  -8.94673 -26.50405
 16.39628 -16.74683 -23.20040  20.68725 -13.79955  -6.18801 -10.16039 -29.27492   8.59590  -5.24184   4.31432 -14.88239 -24.03526
 14.32250  -9.39280 -26.97089   4.83429   3.39828  -2.39738 -21.95024 -13.39398  19.80152   0.90293  12.99902 -19.91159 -15.88038
 13.31528 -12.82958 -27.36625   0.11201   4.02453  19.76130 -11.17524   0.49339  19.44247   7.91951  10.29069 -37.97372 -28.94080
 16.82917 -24.85189 -13.99286  16.96500 -23.02378  58.86952 -32.94793  12.05293  18.85310 -34.24673  33.59675 -30.90870 -30.85413
 16.83069 -28.28792  -5.17871  27.68960 -21.71045  58.01890 -25.68874  14.01145   5.63632 -52.16523  35.18943 -16.56145 -25.97729
 13.26804 -21.50566   3.68606  16.73154  -6.08857  29.18251 -20.16570   4.38664   3.75941 -26.02299   6.00812 -19.00170 -22.15299
 11.51698 -15.72813   7.29360  15.26829  -0.25007  26.64819 -10.57758  -0.48549   5.38971 -32.05917  -0.88861 -16.24067 -21.54215
 10.45655 -12.99065   8.35282   8.81722   3.32212  22.21533   0.84630   5.86038   2.33081 -23.93831  -5.65357 -10.14106 -17.53515
 10.06007 -11.85568   6.52663   5.39204   2.14016  15.61978   4.80648   5.61715   2.42830 -20.40348  -9.19992  -8.86247 -12.70541
  9.69424  -9.97344   6.11084   2.21132   0.47486  11.85403   7.68760   6.42263   6.88160 -19.05552 -13.79929 -10.72983 -13.71686
  9.63249  -7.67649   7.07552  -1.08402  -0.41487  11.93552  14.16966   8.78039   1.33850 -19.92587 -17.75886 -17.64971 -16.14003
  9.60173  -7.66106  10.38169   0.16342   0.58926  10.26926  11.72634   2.99108  -3.42207 -18.24476 -19.67278  -9.70263  -8.00884
  9.64894  -8.12937   8.26486  -3.15465   2.25327  10.74437   5.73340  -0.67037  -2.42691 -16.29469 -16.78531  -6.66535 -12.24336
  9.74349  -8.60494   6.44731  -0.96662   7.32329  10.84121   3.18083   3.48209  -0.39593 -10.70504 -14.24952  -8.17355 -19.43255
  9.67990  -8.66001   5.09892   1.80612  10.90114  12.27726   3.32921   7.84423   0.82451  -4.23454 -10.48293 -11.17836 -17.66856
  9.73896  -9.52376   7.30428   6.40528  12.65519   9.62359   0.63776   8.20039  -0.29990  -3.00910 -14.90116 -10.28214 -15.87993
  9.47100 -10.75075   9.13084   8.86440  15.15841  13.16736   4.19819   4.93789  -6.79818  -3.62959 -21.47292 -11.81217  -8.38863
EOF
)"

diff <(echo -e "${TEST}" | degrad) <(../../bin/fe test/backward_9b8a7439_nohash_3.wav | degrad)
diff <(echo -e "${TEST}" | head -48 | tail -47 | degrad) \
     <(cat <(head -c 1920 /dev/zero) <(tail -c -32000 test/backward_9b8a7439_nohash_3.wav) <(head -c 1280 /dev/zero) | ../../bin/fe | tail -47 | degrad)

TEST="$(cat <<-EOF
  4.99021 -19.59178  11.13104   9.73182   7.31331   3.31160  -0.28622   2.36329 -12.13341  -2.31152  -1.34460  -4.21596  -5.92845
  4.96666 -18.79847  10.69332   7.53786   8.70441   7.28355  -0.34325  -0.42025  -9.88169  -4.23041  -3.34260  -3.59701  -7.35603
  4.78517 -20.15142   8.00002   6.68924   4.17696   3.54096  -4.73997  -5.28595  -7.47442  -4.02217  -0.73195  -0.18656  -4.23969
  5.08766 -21.69646   5.68337  -1.22323  -4.33534   1.47241 -15.10704  -7.15279 -10.04001  -1.93677   1.39055   1.30632  -1.13530
 14.09705 -28.71480 -24.34578 -32.00086 -23.95235 -10.53978 -38.76130 -14.95891 -11.12448  -3.92370 -11.52155   3.10780  -7.93298
 15.14330 -31.99956 -21.62810 -27.66813 -25.49898  -2.56573 -37.81177  -7.87795  -8.10609  -1.70571  -7.94815   4.37340  -8.78398
 15.22825 -28.29025 -15.83755 -18.91919 -17.06573   5.72008 -30.30435  -0.31070  -2.51061   2.87494  -4.84577   6.87742  -6.00013
 13.47409 -26.09567 -17.68827 -26.95240 -13.62719   9.81704 -21.51595  14.30695   1.43666   0.57019 -11.02420   2.31498  -9.73552
 12.88567  -4.36810   3.65584  -7.07300  -2.61229  16.69580 -19.26198  11.23296   1.34202  -2.65003 -14.09458  10.08694 -10.78258
 16.41103  22.34370  14.49414 -11.01371 -30.05514 -13.97500 -31.65126  -1.29935  -5.85825  -5.29417  -8.12995   3.01689  -5.38786
 17.14057  29.89947  20.10267 -17.21474 -60.98396 -16.63285 -42.56740  -7.02940  -3.33172 -19.14858 -12.22477 -18.45283  -9.00947
 17.44246  27.74908  14.42946 -13.00066 -47.43131 -16.93796 -29.57635   2.78737   6.15528  -8.48760  -3.02902 -13.32164  -1.69803
 17.16106  29.41428  18.25165 -14.68254 -55.86304  -2.99676 -26.82709  11.84615  15.99146  -7.36424  -2.57979 -14.29673  -9.55859
 16.92341  24.63558  14.04136 -16.54647 -53.22664 -10.75070 -26.03291  12.26015  14.03242 -12.88481  -4.45260 -22.35876 -15.24448
 16.53570  20.95375   9.85555 -17.74351 -39.56343 -14.14433 -25.78341   7.58276   8.86358  -7.63057   2.72958 -18.00991 -10.71950
 16.46998  27.49248  22.88002 -20.79658 -41.45938  -1.28673 -23.44444   6.22695  20.99941  -7.13427  16.41636  -8.89540  -0.09591
 16.94829  22.12501  12.26250 -20.18206 -45.29532 -13.02841 -18.24237   7.14823  11.66528  -7.76397   1.88182  -6.03168   0.04362
 17.35043  23.20479  19.73147 -26.21339 -63.84520  -3.29431  -4.38690   3.32858  -9.47305  -4.48897  -3.46855   5.41518  -1.33164
 17.51661  22.73029  12.05762 -27.05299 -54.54992  -4.06273  -6.78338   1.48735 -25.67200   0.54429  -0.92266  12.48228 -10.21429
 17.25146  21.77182   5.49801 -27.55017 -37.56012  -6.45437 -14.75380  -0.46155 -28.61405   7.63378   0.67955  13.55235  -9.89293
 16.82616  23.28705   2.97846 -31.59741 -30.58180  -1.53218 -23.52366   2.42938 -36.32058  25.90770  -2.01195   7.66328 -11.44174
 16.50965  24.85525   0.98803 -30.54053 -18.37962   1.99505 -31.81167  15.04855 -31.69411  24.78963  -1.97517   3.28012  -4.49198
 16.11022  23.42324  -0.33253 -38.47391  -9.18846  -9.02260 -43.57198  14.69466 -35.20685  18.41160  -9.38146  -5.74289 -11.33013
 15.74318  24.50839  -1.08718 -33.88865  -5.31734  -5.02628 -46.02337  19.42916 -24.94789  23.44532 -10.47810   4.95270 -14.38182
 15.34276  23.99211  -1.47150 -36.43312   0.02495  -0.26274 -48.37811  15.85910 -17.37182  28.44244 -13.59397   6.40476 -15.05206
 14.83971  24.07042  -1.40267 -39.73926   4.92907   4.66664 -52.07991  11.61999 -13.79409  23.79376 -15.50143  -2.57965 -16.28610
 14.19893  22.12133  -2.73733 -30.30164   4.81372   4.74482 -42.80267   2.22082  -3.45838  21.49228 -18.26102  -2.08071 -19.46428
 13.38963  18.67513  -3.76448 -20.67021   7.48776   6.99358 -35.13969  -0.79319  -0.79388  21.50099 -18.79158  -6.08136 -11.96427
 12.75937  12.99061 -11.22728  -5.58293   1.09648  13.10330 -27.13115 -12.19158  -1.78462  25.01724 -29.59962 -15.79385  -0.87200
 12.19052   4.17903 -21.08334  -7.24988   5.11261  19.45427 -10.24486  -9.69452   6.24442  28.66242 -27.62358 -19.43862   2.98505
 10.65611  -0.51828 -20.68288 -10.73377  -2.46714   7.25738  -2.68261  -6.65895  -2.95982  29.51810 -24.10550 -13.30317  15.45053
  8.64413  -2.91700 -15.94618 -25.37617  -0.69616  13.75272  -2.14841   1.07003  -0.19296   6.98542 -25.98030 -16.94073   7.90421
  7.67246  -6.14698  -7.41165 -13.92805   4.79886  10.35214 -18.94540 -16.43213  -6.49256   2.38071 -30.33268 -31.44325  -6.48916
  6.70177  -5.88147   0.03384  -6.03876  -6.23150   1.56231 -12.49330 -13.08972  -8.26627  -4.15573 -30.55529 -15.86965  -6.77341
  6.57881  -4.69212  15.18968   7.55105   1.64561   1.44673   2.95356   2.34471  -1.18697   3.87426 -18.50102   2.11722  -5.00861
  6.52576  -8.51428  19.17852  14.70969  10.73033   3.76574   0.04640  -1.36187  -5.33152   9.80248  -6.20230  13.37102  -2.61421
  6.29892  -8.64530  18.54923  16.03215  11.85961  12.30529   3.46565  -5.09932  -9.02531   6.28225  -6.60970   5.14138  -2.09950
  5.82130 -12.71144  13.26921  14.41106   4.43419  -0.71550  -0.67953  -4.02538  -6.59097   0.90951  -6.17409  -5.13864 -11.77536
  5.73641 -11.61150  14.20866  13.51287   5.64616  -1.64393   4.05244   5.26165  -3.30901  -4.68720 -14.84457  -3.31085  -6.86876
  5.64690 -11.58639  15.12607  13.17996   6.34726   3.02382  -0.99972   2.91361  -5.63400  -8.32255 -15.43296  -5.08510  -2.00585
  5.75868 -10.10828  15.53641  14.16839  12.10463  12.71325   4.48824  -0.64776  -9.77138  -6.76109  -7.65898  -2.38683  -8.78749
  5.72268 -10.44812  17.42073  17.22590  14.27028   6.74955   1.56377  -1.63479  -9.83309   1.44753  -0.19588  -1.22041 -12.53868
  5.53967 -11.50947  15.41385  14.87715  12.05366   6.58067   4.08452   2.39657  -6.96982   7.26326  -0.80656  -1.93418 -10.70099
  5.40814 -13.06562  14.70463  17.24816  11.91229   4.26564   2.85319   5.80851  -3.69543   6.44073  -4.65701  -0.88872  -6.47889
  5.30380 -14.13968  12.42106  14.90450  14.92308  14.96285   8.55088   5.76148   0.18358   3.25832   1.31860  -2.96816  -8.72684
  5.13527 -15.22214  10.83716  10.90433  11.95466  15.24461   7.39753   4.01562   1.13740   3.13350   4.23460  -0.88081  -8.44110
  5.01262 -15.49469  10.31178   9.43577   5.91165  10.99669   1.10702  -2.04384  -7.01689  -4.33952   2.76512  -1.23535  -5.98290
  5.14428 -16.49007  12.95088   8.55458   7.55162   7.64123   1.27032  -2.47574  -7.56401  -4.77865  -1.90372   0.34595  -4.41423
  4.98274 -18.15873  13.38526  10.81677   7.73212   8.43319   6.12267  -1.42998  -6.36329  -7.71692  -4.27325   1.14723  -5.26240
EOF
)"

diff <(echo -e "${TEST}" | degrad) <(../../bin/fe test/four_079d1020_nohash_2.wav | degrad)
diff <(echo -e "${TEST}" | head -48 | tail -47 | degrad) \
     <(cat <(head -c 1920 /dev/zero) <(tail -c -32000 test/four_079d1020_nohash_2.wav) <(head -c 1280 /dev/zero) | ../../bin/fe | tail -47 | degrad)

TEST="$(cat <<-EOF
  7.21944   4.09427  16.54431   7.54369   9.17277   2.38732  -4.16329  -2.86602  -3.22723  -1.56835  -3.86308  -3.14392  -4.33814
  5.91381  -0.88916   8.97632  -3.26813   0.56013   1.13649  -3.30655   2.83889   4.67443   8.44176  -1.87444   3.13190   0.95631
  5.61679  -7.86226   2.95105 -12.17231 -11.02235  -5.76714  -5.53967  -3.89444   0.54960   2.37448  -2.17573  -0.30940  -6.64700
  5.83047  -3.99010   9.56913   0.28463   0.23693   1.90064  -2.41470  -5.57191  -8.88213  -7.56793 -10.85535 -11.94155 -15.61881
  6.25811  -1.88221  12.97648   4.63554   2.17865   3.05509   0.16718  -5.07019 -11.95456 -10.29899 -15.14924 -16.32160 -16.22253
  6.28071  -1.80352  12.17430   1.24999   1.03921   5.64529   4.43220   0.03890 -11.95226 -13.47907 -16.23417 -13.25081 -14.36723
  5.67661  -4.99817   7.39952  -7.95300 -13.41021  -5.75292  -5.63353 -11.13281 -17.83200 -11.60812  -8.34245  -0.30486  -1.63412
  5.63575 -10.28036   0.16660 -15.78113 -18.37349 -13.93661 -13.32346 -18.74582 -19.46245 -10.31263  -6.75253   4.04748   4.01218
  5.68973  -9.81405   0.91817 -14.56512 -11.20628  -9.23874 -11.67205 -16.47430 -16.46789  -3.84403  -7.55139   5.14165   3.79066
  5.61642 -10.61839   0.50858 -15.21811  -9.68498  -5.30589  -8.06883 -10.84711  -9.67405  -3.37872  -5.94747   3.31015   1.49784
  6.30269  -1.17627  11.80023  -6.45076  -5.89669  -3.79271 -11.26661 -20.69288 -21.92186 -17.56479 -16.07428  -3.01257   1.02667
  6.85016  -3.16546   7.94684 -11.02385 -10.10834 -11.36708 -14.47720 -35.80497 -38.57411 -28.16635 -18.56502 -10.57304  -6.83672
  9.02881 -17.00174  17.68237  -7.92763 -15.34452  -2.39216  -4.36377 -28.32330 -18.49324 -44.26594  -5.54535  -6.78023 -18.55919
  9.14137 -23.57414  10.43633 -15.19224 -20.48902  -6.47099  -1.85781 -21.12684 -11.84926 -35.20795  -0.35821  -3.65060 -19.31788
  8.67515 -26.01495   5.26250 -17.39067 -22.53386  -9.31031  -3.86561 -15.89800  -4.70612 -29.03850   0.20221  -5.37241 -19.03824
  6.67298 -18.50134   0.09604 -16.44401 -12.50074 -10.67459  -7.67572 -15.25196  -5.22457  -6.55106  -5.08883   2.40484 -11.24962
 12.60309 -13.06695 -43.86352 -27.30340  27.63924  16.66664 -17.52468 -30.47526   9.97009  29.78678  -1.78447 -24.16179  -4.78670
 12.71628 -13.13325 -44.73462 -18.62870  34.80912   7.79996 -17.22403 -46.59835   8.24518  42.55041 -11.46499 -28.57281  -5.20766
 12.71573 -10.38989 -41.87486 -16.87598  33.12374   7.11484 -19.62118 -47.39970   1.21662  30.01845 -20.19697 -39.84319 -12.50956
 12.89220  23.14046 -12.50011   0.23752  17.38264  -9.92081 -13.56225  -5.47650  -1.38188   6.37219   0.75502  -4.68358   2.52736
 15.92449  30.45857 -31.03198  11.97581   4.63069 -29.03442  -1.57700 -23.43528  -1.29726  14.94514   0.26846   8.94804   4.98360
 16.69550  17.57131 -21.89022   7.17713   7.25188 -30.98514   6.78425 -28.13317  13.66552   0.71928   5.15805  18.37730  -7.31155
 17.07239  12.93108 -18.78384   7.45691   9.01050 -25.93850   5.46309 -22.01278  15.07799   3.46799   2.07872  13.00688  -6.71417
 17.33024  10.94878 -13.94405   7.55437  19.99484 -25.10059   1.20007 -22.62325  15.19692   3.42080  -2.01075  10.34745  -7.19400
 18.06570   3.25297  -9.15886  16.01763  17.89873 -33.37299 -12.24931 -14.78981  14.82853   3.06841 -14.73195  10.33852  -2.26587
 19.50399  -3.09179 -10.45754  30.06837   2.81327 -39.48822  -5.97547 -28.74321  16.08776  -4.49627 -22.77753  21.34949  -3.86761
 20.17818  -6.41661 -10.67403  32.46789  -7.83796 -50.75728  -0.28110 -29.23706   8.31141 -14.14785 -24.46623  25.16612 -10.73664
 20.42587  -7.39101  -9.09846  34.01519 -10.13457 -50.73965   2.27007 -28.95840   6.20828 -14.68826 -19.19016  27.36327 -10.42788
 20.41061  -7.75523 -10.81633  33.34887 -12.56292 -55.16258   3.88863 -29.85274   3.75210 -22.01690 -22.10932  28.23216 -12.46654
 20.42496 -14.21563  -1.66097  30.28925  -5.90546 -56.10416  -1.31786 -16.74041  -2.92508 -13.68967 -29.88089  30.15990 -11.49124
 20.35914 -20.42762   3.07226  20.74145  -3.21330 -46.89295  -6.86911 -10.73033  -7.14826  -4.50372 -20.76679  21.61349 -12.31124
 20.82679 -26.33429  13.01792  16.70036   2.35599 -39.82897 -16.32393   4.30628  -1.19936   6.01722 -18.16315  13.21113 -11.33360
 21.26651 -35.76701  12.54712  19.27701  16.54782 -27.88290 -16.55741  13.05308   1.03419   8.98402 -14.92719   8.41089  -1.46728
 21.70978 -41.11604  10.06661  21.44800  26.53044 -16.66362 -12.00481  18.16093  -0.67394  14.62899 -13.13144  13.78974  -1.54238
 21.53533 -36.47755   9.69784  14.83287  24.49540 -13.47170  -8.35978  18.49940  -1.78534  15.86989  -8.40857   9.83131  -6.75737
 20.75701 -23.25556   5.72856   0.71162  15.95006 -19.18129 -18.27516   7.76527  -1.52028  22.28210  -3.61920  11.59403   0.18030
 19.58873  -9.80546  -1.53789  -8.75397  11.80114 -19.66194 -15.28511  -3.30534  -3.18584  22.15222   7.70697  19.29958  -0.62111
 19.09856  -0.69698  -9.72460 -10.80659   3.50840 -17.34854  -7.70476 -10.33483  -9.34902  19.49098   7.52690  26.33542  -2.49236
 18.93637   1.83219  -7.01342 -15.87571 -10.50338 -17.21311   6.00334  -6.98688  -8.95565  12.08455   7.61725  25.21398 -11.58056
 18.58415   2.86949  -6.97617 -17.06428 -28.31497 -13.67219  13.40562  -2.16838 -13.98164   4.16115   5.31246  22.63547 -17.40853
 18.16938   5.77269 -10.46703 -13.33073 -38.75082 -15.55803   5.42612   1.16388 -12.93438   2.21311   3.73266  19.85927 -17.99731
 17.42066   9.07729  -5.42025 -13.78306 -38.27376 -14.16901  -4.29482  -1.12747 -10.40748   8.32427   0.88096  22.65772 -18.51014
 16.72437  11.89117  -0.66217  -6.49365 -31.98256 -16.32082  -8.63866   0.73100 -10.62469   8.86756  -5.01423  21.18451 -14.13071
 15.69508  12.70101   4.56444  -7.21306 -38.42987 -19.24014   2.34925  -0.93559 -10.18883   5.40106  -6.56816  13.69675 -19.47567
 14.89377  16.70408  11.88369  -2.57917 -43.13742 -24.97729   5.03243   7.50648 -14.37235  -3.89490  -6.92606  15.76607 -23.01217
 13.82874  22.54655   8.62160  -1.97015 -29.18957 -14.45576  -8.34127   2.85711  -2.50353 -16.28882   7.07148  14.89202  -7.66765
 12.35331  23.34279  20.67100   1.67385 -23.91223 -22.57236 -11.20728  18.25377   4.55922   6.32488   9.30126   0.28437 -13.53710
 11.11693  22.56930  18.77333  -2.18249 -17.14039  -9.77888   0.12578  11.59540   1.55756   8.74466  -2.93939  -2.22844 -12.22366
  9.67653  12.61777  15.48856  -3.34944 -19.85267 -19.30353 -10.57646   3.28574  -1.22977  13.45885   7.66162  17.05569  -0.17968
EOF
)"

diff <(echo -e "${TEST}" | degrad) <(../../bin/fe test/visual_195c120a_nohash_4.wav | degrad)
diff <(echo -e "${TEST}" | head -48 | tail -47 | degrad) \
     <(cat <(head -c 1920 /dev/zero) <(tail -c -32000 test/visual_195c120a_nohash_4.wav) <(head -c 1280 /dev/zero) | ../../bin/fe | tail -47 | degrad)

TEST="$(cat <<-EOF
 12.91158  -7.59796   7.87403   9.90628   4.81347   6.02117  -1.01038  10.39901  -1.65729   1.43407  -4.11061  -0.54185   2.99863
 12.98702  -5.78163   8.44579  10.35612   5.15868   1.34366  -6.04448   6.06952  -6.73294  -1.87444  -6.95526  -4.16626   0.89648
 12.98561  -5.57254   9.33881  13.32859   8.13110   2.58661  -9.60976  -1.63579  -9.87785  -1.35143 -12.04853  -2.30912  -4.68318
 12.90839  -5.89254  10.02532  12.38969   5.36485  -1.26365 -14.16137  -3.65708  -8.19407   1.98312  -7.93063  -1.16177  -8.47622
 12.83535  -7.13684   9.71055   8.61592   2.56225  -0.87853 -11.51487  -2.77060  -4.38538   3.26392  -5.99442   0.21237  -7.43754
 12.78043  -9.87912   7.32186   5.53545   0.57226   4.11851  -2.94247   2.90792   2.71278  10.09555  -1.02293   0.59539  -5.52784
 12.87636 -11.33046   6.68091   4.96252  -1.29497   0.98983  -2.98590  -1.46501  -4.26698   5.67396  -4.91435  -0.29525  -4.64965
 12.94716 -10.79744   7.56260   6.40295  -1.12382  -0.62202  -6.92424  -0.14014  -4.69490   6.97334  -3.44677  -2.06210  -4.75547
 12.84624 -11.27014   6.65439   8.28256   0.46308   1.18084  -7.30291  -0.21230  -4.25510   5.99007   0.08804  -1.00491  -7.09566
 12.71165 -13.22134   4.14044   9.01397   4.58899   2.31723   0.31307   3.38726   2.32693   9.71180   1.17164   0.73259  -6.43000
 12.63555 -12.27312   5.74383   7.87240   2.78747  -0.51258  -3.60151   2.32427   1.55778   6.42529  -4.86141  -2.10375  -5.94305
 12.66378 -11.77805   3.83341   7.79588   1.73822   2.02355  -4.17639  -0.23752  -1.09354   5.00167  -6.92204   1.35757   0.13319
 12.80252 -12.60271   4.32370   6.78395  -0.98004   0.88622  -4.13263  -2.06995  -5.37264   6.39943  -2.66405   6.72765   1.37390
 12.82776 -13.36469   3.12964   4.71061  -0.89971   3.81207   0.78818   3.34098  -1.22248  10.33314   1.08310  12.51560   4.54330
 12.85893 -11.34324   6.54101   6.68795   0.76538   5.54675  -1.36799   1.37114  -1.98303  11.22417  -0.41236   8.30124   1.48317
 12.85958 -10.44089   5.77039   6.10571   1.03984   5.67656  -0.60765   4.32140  -1.91232   6.51824  -1.79258   5.74381  -6.76328
 13.30605 -10.44841   9.17694   5.97091   4.12622   7.05691  -5.21789   1.24776  -5.91494   5.80119  -0.63053   2.40587  -6.23786
 16.31332 -25.68271   4.54778  13.01587   3.99857   8.26978  -6.34085  -7.28289  -8.39072   5.89423  -7.35561  -7.20639  -0.20952
 16.96376 -29.59201   4.27214  13.92084   9.71171   8.85802  -6.30274  -9.47988  -4.30403  11.39213  -3.53963  -5.79049  -4.53931
 17.28268 -30.98071   0.29986   7.91535   6.63213   9.69042  -2.89992  -5.03469  -2.34969   9.79430  -1.93465   1.08566  -0.79156
 17.98797 -33.49605  -0.03991   8.44900   4.80185   9.59449  -2.43850  -9.96512   0.77070  18.99601  -0.85596   1.01227   5.55364
 18.35654  -6.21040   2.89402 -17.16899 -25.95429  -2.12720   2.40557  -7.21455  -7.40493   9.74775  -5.11319  -5.90490  -3.29119
 19.69249   7.42481  -6.14102 -25.14993 -20.48912   9.96044   8.08603  -8.30595  -8.02698  11.21338   0.57995 -13.71658  -9.26967
 20.70448  13.04273 -23.58670 -27.16754 -28.37408  13.85935  -4.60829  -7.13490 -20.65732   8.74129  -6.69467 -16.85450 -21.63328
 21.14237  10.01572 -23.52345 -26.00320 -20.61325  19.56056  -2.89874  -6.10115 -14.15527  11.29926  -6.99345 -10.77329 -16.14248
 21.27591   5.50150 -26.06742 -28.11421 -24.12213  22.60653  -8.81002 -10.25763 -19.07343  12.13619 -11.69268 -15.90339 -16.99900
 21.31088   3.11077 -28.00592 -24.57167 -22.10490  22.34813 -13.48875 -10.37121 -18.77030  12.48854 -13.48422 -14.16657 -11.44889
 21.23133   4.35971 -26.51965 -19.47548 -16.88912  23.85323 -14.51961  -2.88904 -17.64922  15.92056 -12.94863 -10.48575  -3.73343
 21.07964   2.40150 -31.20402 -17.53214 -23.10451  18.70287 -25.48232  -1.41261 -20.92932  12.41461 -20.78153 -11.74151  -4.69235
 20.67142   3.06417 -28.48838 -10.67229 -22.42510  17.30585 -28.92542   9.30782 -12.84305  16.76736 -18.52627  -4.54297  -1.89433
 20.32333  -0.73102 -22.91711  -7.98981 -23.99358   4.01753 -30.56406   9.59603  -4.73149  14.42129 -21.38435  -6.12439  -5.98367
 19.97772  -0.13159 -12.07725   1.57224 -25.73139  -5.11443 -31.65859  18.09693  -0.83475  20.64580 -17.58740   3.67641  -2.98356
 19.69757  -3.39012  -6.74798   7.65180 -38.67632 -25.79532 -39.37918  14.12176 -14.59494  18.23874 -11.99586   9.40383 -11.48737
 19.69722  -1.77855   1.37437  16.80228 -36.13950 -30.02323 -35.78754  16.77231 -19.18077  16.61671   1.30243  16.38172  -4.05858
 19.48088   0.04704   3.40970  17.54474 -28.13875 -33.07724 -39.70498  14.54384 -19.72775  13.73026   3.32642  19.35484   0.44083
 18.70649   1.75746   4.36832  17.02892 -21.39955 -34.60793 -46.68046  13.46506 -19.53955   8.23320   5.38814  10.26659  -0.34768
 17.23531  -3.00826   8.29489   4.56244 -13.98734 -39.95612 -47.13268  -0.88896  -3.88002  -1.60297   0.63880   2.18559   1.59250
 17.09515 -22.55330  10.57333   3.71111   1.35607  -8.32146 -16.12678  -6.58820   0.40409  12.63837 -14.69032   4.59535   1.22461
 17.27039 -28.29222   6.86959   3.37008   5.01342  -0.14478 -13.70029  -7.41662   0.40703  12.22050 -11.86450   7.29079   6.24112
 17.02031 -28.62963   5.59640   1.06735   5.97012   4.18480  -9.08383  -1.11249   4.75704  11.25761 -12.31100  12.58956  10.88749
 14.22552 -14.57969   1.30137   1.15800   1.64968   7.10587 -10.99810   4.44204  12.76117  12.67854   2.66824  12.27407   8.26675
 13.23891 -10.42263   0.52660   1.81480  -3.42060  -1.80032 -12.42606   4.33467   4.52192   9.39258   2.65118  12.80730   5.19572
 12.90644  -9.61111   6.15471   6.50437   3.23361   3.81170  -4.47111   1.39247   1.20059   3.85279  -1.66663   6.51137  -0.55210
 12.93769 -10.73048   6.68709   8.78468   3.68967   5.97970   0.80261  -0.08105  -1.10944  -2.11103  -3.38018   7.43346   2.11181
 13.03475  -7.79255   8.69254  10.87095   3.74442   3.94600  -3.98868  -2.56879  -0.42142  -1.65303  -9.75507  -0.44073  -1.06457
 13.06597  -5.90004  11.34685  11.43332   6.20044   2.75005  -8.68733  -3.21816  -1.52547  -4.86996 -13.33747  -6.26464  -4.81164
 13.19684  -7.28244  12.26427  11.84119   7.76705   4.02370  -7.91031  -2.98188  -3.21671  -5.91350 -13.29132  -8.14455  -9.83101
 13.14541  -8.76835  11.91101  10.82737   7.49192   3.59996  -7.59165  -0.86528  -7.29261  -2.77005  -2.48715  -4.38489 -10.96321
 12.80271  -9.05868   9.73261   6.71313   4.66319   0.67906  -8.99313   4.17462  -2.77649   3.17412   5.28058   4.89841  -3.08938
EOF
)"

diff <(echo -e "${TEST}" | degrad) <(../../bin/fe test/five_01648c51_nohash_0.wav | degrad)
diff <(echo -e "${TEST}" | head -48 | tail -47 | degrad) \
     <(cat <(head -c 1920 /dev/zero) <(tail -c -32000 test/five_01648c51_nohash_0.wav) <(head -c 1280 /dev/zero) | ../../bin/fe | tail -47 | degrad)

TEST="$(cat <<-EOF
 11.97980  -1.81050   4.03155  -0.93838  -1.60749  10.97200  -6.99220   4.10830 -10.82180   7.42327 -10.97298   5.80736  -0.97937
 11.93963  -3.35422   2.48904   0.47242   1.25831   9.48307  -7.83414  11.56513 -11.25586  12.70242 -10.21088   6.23366  -2.03203
 12.39114  -5.08070   1.69163   1.68369  -0.39455  12.06386  -2.42826  11.76621 -18.07976  16.08695 -13.50885   9.87172  -1.64210
 12.36452  -5.45129   2.19984   2.47089  -0.68392  13.05337  -0.55539   9.30649 -20.21998  13.86946 -14.28329   9.04912  -4.02193
 12.16707  -3.56098   1.05258   0.96498  -3.58041   8.57972  -2.94846   4.53671 -15.62666   9.95596 -13.45244   4.51306  -4.09585
 13.38070 -10.93264   6.29455   5.39093 -19.44064  15.57116  -8.16128  -0.23375  -8.81943  15.25449 -18.44024  10.55026   4.39736
 15.32029 -18.40210   3.56049  12.49795 -24.14565  28.21543 -23.87099   1.80660  -1.69243  16.24301 -15.12332   7.67968  10.15508
 15.42024 -20.33202   3.37466  12.25092 -23.21458  24.93092 -28.49492   2.59140   5.66411  25.18032 -11.70458  10.44188   9.50068
 14.09620 -13.74587   3.87816   7.97240 -14.51154  23.29378 -29.65438   0.55433  -0.79547  17.13733 -13.62083  14.84158   7.59984
 13.19552  -8.69554   7.12511  -0.13961  -5.28602  17.60626 -26.83114   4.27569 -11.07406  14.32588 -11.08526  13.24356   0.35190
 12.92304  -6.45643   9.00095  -1.38554  -3.91381  11.87340 -19.37727   2.04754 -20.65506   9.88167 -13.59167  15.53099  -5.23444
 12.76316  -4.28416   7.41013  -3.24052  -2.22060  11.16099 -17.60691   4.20320 -21.86386   5.46908 -17.38870  15.26000  -3.42426
 12.66489  -4.02105   5.59975  -3.03848   0.60564  10.68667 -15.82373   5.04216 -18.99382   8.49147 -20.71577  10.51760  -1.46407
 12.67729  -3.60078  -3.97534  -2.50279   4.19005   4.41928 -16.89993  12.02908 -17.04298   9.35620 -12.89263   7.94191  -7.61366
 13.64233  -4.36375 -16.35446   3.83839   9.83151  -4.72388 -12.53035  11.25419 -22.94436   2.96009  -9.84391   7.51691 -10.04907
 15.30878  -9.45635 -27.29395  10.69434   5.54800  -0.91522  -8.85985   7.18371  -9.81764  -7.01366  -6.30600  -3.11611 -11.42536
 16.60719 -14.09140 -35.24119  15.51599  -0.49685   6.07013 -10.14488   9.11473  -4.74945  -3.66145  -4.67732   5.68952 -24.75058
 17.24058 -15.68588 -39.99459  10.30835   1.63702   7.36776  -8.61840  14.11868   1.85173   2.38538  -1.49813  -0.82402 -24.08485
 18.71657   2.51759 -41.48863 -16.79873 -10.40888   2.49897 -15.54231  -0.60054 -14.43637  -4.24603 -14.43013 -20.56312 -31.59677
 19.78592   9.58381 -43.38155 -31.70352 -12.24837  -5.68197 -18.39809  -8.07821  -8.85138   1.27255 -18.36626 -18.74459 -20.18926
 20.22689  17.22842 -41.41569 -30.67222  -5.70459   0.85804  -8.06914   1.09573  -4.55428  12.41017 -18.12707  -7.27635 -21.15313
 20.21030  17.71067 -41.28536 -35.52200 -10.94175  -6.26275  -6.79392  -5.59767  -5.85790   8.30331 -15.73699 -10.59714 -17.00519
 19.91343  20.47131 -34.03811 -29.70372 -15.01314  -3.20929  -2.84573  -8.61151  -3.89024  11.10555 -14.65224  -8.52808 -11.19104
 19.38780  18.85289 -27.60077 -31.92744 -27.39734  -2.76987  -9.55943 -13.10740  -4.11958  14.71519 -24.11727 -13.50403 -14.58402
 18.59432  17.91940 -17.22816 -29.58794 -31.48602   1.00449 -12.57494 -15.61983  -5.71053  18.30571 -17.46460 -10.64368 -20.57251
 17.91380  18.92051  -9.01782 -24.97822 -28.40008   5.26502 -10.99616 -13.90676  -7.25861  13.21014 -11.40055   0.24723 -15.94678
 16.89059  16.80537  -3.57491 -29.18562 -24.55718   9.62171 -21.03518 -21.78257 -29.11815  20.30485 -14.84186  -3.23270 -20.08588
 15.62014  12.14264   1.05071 -20.53581 -17.97607  16.60595 -18.91330 -20.59137 -32.76844  18.64831 -21.22750  -0.92819 -12.34601
 15.08612  -0.68933  -2.25399 -10.77152 -17.60181  17.99287 -20.21228 -11.85234 -14.17580   6.92267 -11.41405  14.89548 -26.52309
 16.30335 -17.08142  -6.74835  -0.72876 -22.07583  20.50831 -23.67877  -0.51404   3.63536  12.79321 -11.98998   2.10594 -22.26610
 17.39030 -23.99157   1.16490   1.12479 -18.19698  17.57705 -29.11502  -2.07981   1.11158   5.49431 -13.33765  -0.53294 -12.63296
 17.94227 -28.77077   5.65215   5.83981 -10.75565  22.29575 -32.56332  -0.15366  -3.49818   2.55780 -19.65443  -6.12709  -7.16440
 18.20367 -31.23934  10.20588   6.05662  -3.46128  18.18024 -33.19827   3.29469  -7.64610  -1.76407 -17.77463  -2.66588  -9.33468
 17.95649 -31.73604   9.63855   4.32620   1.62696  17.02862 -32.31951   3.66208 -12.17910  -2.72968 -15.91939   1.17654 -10.13187
 17.49206 -30.32068  13.64197   4.23762   1.16393  12.23248 -28.63371   2.48020 -13.04678  -0.79149 -12.79129   1.82966  -6.63176
 17.32142 -29.45046  14.68717   1.28289  -3.47906  12.53387 -28.81766   4.50960 -15.36077   8.70938 -14.99196   9.30295  -3.63832
 17.12969 -27.21572  14.96540   0.15819  -1.89416  15.59306 -24.00344  11.04487 -17.65410   6.77905 -20.52293  13.66838   1.62260
 16.90442 -27.82181  13.16946   1.16680  -4.12330  17.16873 -17.70542  11.63759 -21.26612   2.62885 -19.82607  13.69314   7.25631
 16.66990 -28.42405  11.56093   2.66212  -7.32251  17.95143 -15.59270  11.55867 -17.07198   6.53832 -14.29977  12.58291   4.01717
 16.57317 -27.64079  11.92757   0.58193 -10.52061  21.86391 -18.45236  12.66069 -14.19748   5.76942 -12.48262   8.50899   2.40313
 16.34338 -26.05322  13.27178  -0.71213 -10.84503  24.56110 -23.96559  12.95468 -12.85369   5.68676 -11.55344  12.49183   2.20944
 16.09788 -23.76308  13.63628  -5.29231 -17.36492  22.72718 -20.05274  21.39484  -6.03836  12.82531 -13.01129   2.51318   0.72161
 15.58165 -20.87831  12.29980  -1.99341 -18.42404  24.74790 -18.22339  23.28876  -4.87041  11.44249 -11.46449   1.78735  -3.13448
 14.80731 -17.69495   9.89279   4.42350 -16.18492  24.88070 -21.09256  15.81139  -7.61388   3.81749 -10.13402   5.20439   1.81992
 14.09130 -14.08074   9.64154   4.39036 -14.08536  25.39217 -19.04281  16.14430  -9.11765  -1.93645 -16.41124   2.96176  -1.62640
 12.86900  -8.44647  10.10805  -2.09237  -4.24627  11.39013 -12.43915  11.93535 -15.77002   5.53440 -12.16358   3.42799   0.66154
 12.88446  -5.92122   8.66498  -4.60296  -3.32450  13.14428 -16.82545   8.35589 -22.32686  10.54255 -13.19566  11.92060  -0.61126
 13.11078  -6.43054  10.47359  -4.28865  -0.80261  12.43891 -17.84267   6.18672 -27.63893  15.05305 -16.66261  14.91456  -0.67491
 12.85990  -5.16994  10.69906  -4.60152  -1.22219  11.16140 -16.15056   7.43276 -24.75105  15.15992 -21.32115  16.54124   1.75991
EOF
)"

diff <(echo -e "${TEST}" | degrad) <(../../bin/fe test/house_37bd115d_nohash_0.wav | degrad)
diff <(echo -e "${TEST}" | head -48 | tail -47 | degrad) \
     <(cat <(head -c 1920 /dev/zero) <(tail -c -32000 test/house_37bd115d_nohash_0.wav) <(head -c 1280 /dev/zero) | ../../bin/fe | tail -47 | degrad)

echo "Features extractor build OK!"